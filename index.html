<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ruben AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
  <!-- === STYLE === -->
<style>
  :root {
    --bg: #f5f1e6;
    --panel: #ddd;
    --header: #a12222;
    --text: #333;
    --copy-bg: #ffd800;
  }
  body.dark {
    --bg: #222;
    --panel: #333;
    --header: #550000;
    --text: #eee;
    --copy-bg: #ffb400;
  }

  body {
    font-family: 'Poppins', sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0; padding: 0; height: 100vh;
    display: flex; flex-direction: column;
  }
  header { background: var(--header); color:#fff; padding:1rem; text-align:center; }
  #chat { flex:1; overflow-y:auto; padding:1rem; }
  .message { margin:1rem 0; white-space: pre-wrap; }
  .user      { font-weight:bold; }
  .assistant { font-style:italic; }
  #form { display:flex; padding:1rem; background:var(--panel); gap:.5rem; }
  textarea { flex:1; padding:.5rem; font-size:1rem; resize:none; }
  button { padding:.5rem 1rem; border:none; cursor:pointer; }
  .copy-btn {
    background:var(--copy-bg); border:none; border-radius:50%;
    width:24px; height:24px; font-weight:bold; cursor:pointer; margin-left:.5rem;
  }
  #modelSelect { padding:.4rem; }
  #darkToggle { background:none; color:#fff; border:none; position:absolute; right:1rem; top:1rem;}
</style>


</head>
<body>
  <header>Ruben AI</header>

  <div id="chat"></div>

  <form id="form">
    <input id="userInput" type="text" placeholder="Type your message..." autocomplete="off" />
    <select id="modelSelect">
      <option value="gpt-4o">gpt-4o</option>
      <option value="gpt-4">gpt-4</option>
      <option value="gpt-4-1106-preview">gpt-4-mini</option>
      <option value="gpt-4-0125-preview">gpt-4.1</option>
    </select>
<input type="file" id="fileInput" accept=".txt,.md,.csv,image/*">
    <button type="submit">Send</button>
  </form>

<!-- === SCRIPT === -->
<script>
  /* ----------  Dark‑mode toggle  ---------- */
  const toggle = document.createElement('button');
  toggle.id = 'darkToggle';
  toggle.textContent = '☾';
  toggle.onclick = () => document.body.classList.toggle('dark');
  document.body.appendChild(toggle);

  const chat    = document.getElementById('chat');
  const form    = document.getElementById('form');
  const input   = document.getElementById('userInput');
  const modelEl = document.getElementById('modelSelect');

  /* auto‑grow textarea */
  input.addEventListener('input', e => {
    input.style.height = 'auto';
    input.style.height = input.scrollHeight + 'px';
  });

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const prompt = input.value.trim();
    if(!prompt) return;
    append('You', prompt);
    input.value=''; input.style.height='auto';

    const res = await fetch('/api/chat', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ prompt, model: modelEl.value })
    });
    const data = await res.json();
    const text = data.response || data.result || data.choices?.[0]?.message?.content || '[no reply]';
    append('Ruben', text, true);
  });

  function append(sender, text, copyable=false){
    const div = document.createElement('div');
    div.className='message '+(sender==='You'?'user':'assistant');
    div.textContent = `${sender}: ${text}`;
    if(copyable){
      const btn = document.createElement('button');
      btn.textContent='C'; btn.className='copy-btn';
      btn.onclick = ()=>navigator.clipboard.writeText(text);
      div.appendChild(btn);
    }
    chat.appendChild(div); chat.scrollTop=chat.scrollHeight;
  }
</script>
</body>
</html>
