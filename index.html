<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ruben AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
 <input type="file" id="fileInput" accept=".txt,.md,.csv,image/*">



</head>
<body>
  <header>Ruben AI</header>

  <div id="chat"></div>

  <form id="form">
    <input id="userInput" type="text" placeholder="Type your message..." autocomplete="off" />
    <select id="modelSelect">
      <option value="gpt-4o">gpt-4o</option>
      <option value="gpt-4">gpt-4</option>
      <option value="gpt-4-1106-preview">gpt-4-mini</option>
      <option value="gpt-4-0125-preview">gpt-4.1</option>
    </select>
<input type="file" id="fileInput" accept=".txt,.md,.csv,image/*">
    <button type="submit">Send</button>
  </form>
<!-- =============== SCRIPT =============== -->
<script>
  /* ---------- Dark‑mode toggle ---------- */
  const toggle=document.createElement('button');
  toggle.id='darkToggle'; toggle.textContent='☾';
  toggle.onclick=()=>document.body.classList.toggle('dark');
  document.querySelector('header').appendChild(toggle);

  const chatDiv   = document.getElementById('chat');
  const form      = document.getElementById('form');
  const textarea  = document.getElementById('userInput');
  const modelSel  = document.getElementById('modelSelect');
  const fileInput = document.getElementById('fileInput');

  /* ---------- auto‑grow textarea ---------- */
  textarea.addEventListener('input', ()=> {
    textarea.style.height='auto';
    textarea.style.height = Math.min(textarea.scrollHeight, textarea.maxHeight|| textarea.scrollHeight) + 'px';
  });

  /* ---------- helper: append message ---------- */
  function append(sender,text,copy=false){
    const div=document.createElement('div');
    div.className='message '+(sender==='You'?'user':'assistant');
    div.textContent = `${sender}: ${text}`;
    if(copy){
      const btn=document.createElement('button');
      btn.className='copy-btn'; btn.textContent='C';
      btn.onclick=()=>navigator.clipboard.writeText(text);
      div.appendChild(btn);
    }
    chatDiv.appendChild(div); chatDiv.scrollTop=chatDiv.scrollHeight;
  }

  /* ---------- helper: file->base64 ---------- */
  function fileToBase64(f){
    return new Promise((res,rej)=>{
      const r=new FileReader();
      r.onload=()=>res(r.result);
      r.onerror=rej; r.readAsDataURL(f);
    });
  }

  /* ---------- form submit ---------- */
  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const prompt=textarea.value.trim();
    if(!prompt) return;
    append('You',prompt);
    textarea.value=''; textarea.style.height='auto';

    let textFile='', imageB64='';
    const file=fileInput.files[0];
    if(file){
      if(file.type.startsWith('image/')){
        const b64=await fileToBase64(file);
        imageB64=`data:${file.type};base64,${b64.split(',')[1]}`;
      }else{
        textFile = await file.text();
      }
      fileInput.value='';
    }

    const body={
      prompt,
      model:modelSel.value,
      memoryKey:'global-note',  // change if you want per‑user
      textFile,
      image:imageB64
    };

    const res = await fetch('/api/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(body)
    });
    const data = await res.json();
    append('Ruben', data.response || data.error || '[no reply]', true);
  });
</script>
</body>
</html>
